
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Design &#8212; Pharmpy 0.17.0 documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changelog" href="changelog.html" />
    <link rel="prev" title="TO-DO" href="todo.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="index.html">
    
      <p class="title">Pharmpy</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started.html">Getting started</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="user_guide.html">User guide</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="reference/modules.html">API reference</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="development.html">Contribute</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="changelog.html">Changelog</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="license.html">License</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/modules.html">API reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="development.html">Contribute</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="NONMEM.html">NONMEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="todo.html">TO-DO</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="development.html#development-environment-installation">Development Environment Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="development.html#releasing-pharmpy-and-documentation">Releasing Pharmpy and documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="development.html#version">Version</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/design.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#dependencies" class="nav-link">Dependencies</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#introduction" class="nav-link">Introduction</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#the-heart-the-model-class" class="nav-link">The Heart, The Model Class</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#the-model-apis" class="nav-link">The Model APIs</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#api-module-execute" class="nav-link">API module: execute</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#job-class" class="nav-link">Job class</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#rundirectory-class" class="nav-link">RunDirectory class</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#environment-class" class="nav-link">Environment class</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#engine-class" class="nav-link">Engine class</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#api-module-output" class="nav-link">API module: output</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#property-operations" class="nav-link">Property: operations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#property-dispatcher" class="nav-link">Property: dispatcher</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#api-module-transform" class="nav-link">API module: transform</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#api-module-tool" class="nav-link">API module: tool</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#design-ideas" class="nav-link">Design & Ideas</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#second-layer-abstraction" class="nav-link">Second-layer abstraction</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#no-caching" class="nav-link">No Caching</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#inherit-base-types" class="nav-link">Inherit Base Types</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#why-multiple-apis" class="nav-link">Why Multiple APIs?</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#methods" class="nav-link">Methods</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="design">
<span id="id1"></span><h1>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>Three of the Pharmpy dependences has a special status. These are sympy, pandas and numpy. These packages are considered
to be central in the python scientific ecosystem. Thus exposing objects from classes defined in these packages is ok
and encouraged in the Pharmpy API. This will make it easier for users to build on Pharmpy and removes the need for wrapping
these object into the Pharmpy API. Since symengine objects share API with sympy exposing symengine objects is also ok.</p>
<p>Classes and APIs for all other dependencies should not be exposed to users to avoid leaking third party APIs. This will
simplify replacing dependencies without breaking the Pharmpy API.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The rest of this document is outdated.</p>
</div>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="reference/pharmpy.html#module-pharmpy" title="pharmpy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Pharmpy</span></code></a> is structured into a generic <em>template</em>, defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">pharmpy.generic</span></code>, and
<em>implementations</em> of that template. The implementations define the API, but are guided and assisted
by the generic template.</p>
<p>A NONMEM7 development implementation (top at <code class="xref py py-mod docutils literal notranslate"><span class="pre">pharmpy.api_nonmem</span></code>) is <em>the</em> implementation so far
and will thus stand-in for <em>any</em> implementation in this document.</p>
</div>
<div class="section" id="the-heart-the-model-class">
<h2>The Heart, The <code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> Class<a class="headerlink" href="#the-heart-the-model-class" title="Permalink to this headline">¶</a></h2>
<p>The main (and only, so far) entry point is <a class="reference internal" href="reference/pharmpy.model.html#pharmpy.model.Model" title="pharmpy.model.Model"><code class="xref py py-func docutils literal notranslate"><span class="pre">pharmpy.model.Model()</span></code></a>, which abstracts the particular
model class call and returns the object.</p>
<p>Basic ideas:</p>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code> template is model (type) <em>agnostic</em></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Implementation</span></code> is <em>not agnostic</em>.</p></li>
<li><p>No entanglement with output and runs, just the model definition</p></li>
<li><p>Implementation detects support (to get the job) and parses one type of model</p></li>
<li><p>Duck typing is the aim. However, an implementation <em>must</em> inherit the generic template to guide consistency in implementation and cause fallthrough to <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>.</p></li>
</ul>
</div>
<div class="section" id="the-model-apis">
<h2>The Model APIs<a class="headerlink" href="#the-model-apis" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Thou shalt not bloat the Model class.</p>
</div>
<p>A pharmacometric model and workflow has many facets. APIs are abstract concepts like operations on
models, of which these exist thus far:</p>
<blockquote>
<div><table class="colwidths-given table">
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Template (generic)</p></th>
<th class="head"><p>NONMEM7 (implementation)</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">generic</span></code></p></td>
<td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">api_nonmem</span></code></p></td>
<td><p>Top-level module</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="reference/pharmpy.model.html#module-pharmpy.model" title="pharmpy.model"><code class="xref py py-mod docutils literal notranslate"><span class="pre">model</span></code></a></p></td>
<td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">model</span></code></p></td>
<td><p>Binds everything else together</p></td>
</tr>
<tr class="row-even"><td><p><strong>WIP</strong></p></td>
<td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">input</span></code></p></td>
<td><p>Model input (the data)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">parameters</span></code></p></td>
<td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">parameters</span></code></p></td>
<td><p>Parameter model abstraction</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">execute</span></code></p></td>
<td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">execute</span></code></p></td>
<td><p>Execution of model</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">detect</span></code></p></td>
<td><p>Detection of model support</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">records</span></code></p></td>
<td><p>Non-agnostic implementation detail example</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="api-module-execute">
<h3>API module: <code class="xref py py-mod docutils literal notranslate"><span class="pre">execute</span></code><a class="headerlink" href="#api-module-execute" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This needs some more thought (from someone who isn’t me).</p>
</div>
<p>See <code class="xref py py-mod docutils literal notranslate"><span class="pre">the</span> <span class="pre">package</span></code> and its modules (and their classes) for technical information.</p>
<p>This package defines four classes. These are my (module documentation non-overlapping) thoughts
about them.</p>
<div class="section" id="job-class">
<h4><code class="xref py py-class docutils literal notranslate"><span class="pre">Job</span></code> class<a class="headerlink" href="#job-class" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Will need to inherit where <cite>~pharmpy.execute.environment.Environment</cite> does.</p></li>
</ul>
</div>
<div class="section" id="rundirectory-class">
<h4><code class="xref py py-class docutils literal notranslate"><span class="pre">RunDirectory</span></code> class<a class="headerlink" href="#rundirectory-class" title="Permalink to this headline">¶</a></h4>
<p>Will not need non-generic extensions (as I see it).</p>
<p>If no parent directory given, temporary directory shall be created (and destroyed). There shall not
be any implicit usages of working directories or special meaning attributed to <code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.path</span></code>.</p>
<p>Purpose is to contain input/output files and the execution process of a “execution-like task” of
a model. Thus, it has an attribute, <code class="xref py py-attr docutils literal notranslate"><span class="pre">RunDirectory.model</span></code> which “takes” a model via performing a deepcopy if
not in directory already, and changing <code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.path</span></code>. That <cite>path</cite>
change should then trigger a re-pathing of the intra-model (relative) paths (e.g. to data).</p>
<blockquote>
<div><div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Changing <code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.path</span></code> should trigger changes to all contained
relative paths.</p>
</div>
</div></blockquote>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">RunDirectory</span></code> is a <strong>sandbox</strong> for execution, even if trivially
escapable. Thus, it should also provide methods for file operations that ensure the operation is
contained.</p>
<blockquote>
<div><div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>Develop “safe” file operation methods for <code class="xref py py-class docutils literal notranslate"><span class="pre">RunDirectory</span></code>.</p>
</div>
</div></blockquote>
<p>Class shall expose an API that can be used to copy back the resulting (output) files, just as PsN
does, but it <em>must</em> be requested explicitly. If not used when run directory is temp directory, this
<em>must</em> guarantee loss of files. The copy will occur whenever requested or in
<code class="xref py py-func docutils literal notranslate"><span class="pre">pharmpy.execute.run_directory.RunDirectory.__del__()</span></code>, just as file deletion works already.</p>
</div>
<div class="section" id="environment-class">
<h4><code class="xref py py-class docutils literal notranslate"><span class="pre">Environment</span></code> class<a class="headerlink" href="#environment-class" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Needs an implementation per OS (Posix/Windows) and per system (system, SLURM, etc.).</p></li>
<li><p>Execution without SLURM etc. is called “system execution”.</p></li>
</ul>
</div>
<div class="section" id="engine-class">
<h4><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code> class<a class="headerlink" href="#engine-class" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Creates Job objects, executing some task, for a <em>specific</em> implementation.</p></li>
<li><p>Contains Environment object. The focal point for implementation inheritance.</p></li>
</ul>
</div>
</div>
<div class="section" id="api-module-output">
<h3>API module: <code class="xref py py-mod docutils literal notranslate"><span class="pre">output</span></code><a class="headerlink" href="#api-module-output" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This needs some more thought.</p>
</div>
<p>A proposal:</p>
<p>pharmpy has one base class for output called Output (or Results, which might be better). This only contains some metadata, filepaths etc and is then subclassed for each type of results. For example: EstimationResults, SimulationResults, CovarianceResults, SIRResults, BootstrapResults, FREMResults etc. Each subclass will find an appropriate way of storing its results. These subclasses should be as self contained and general as possible. For example the SIRResults could be populated from either NONMEM SIR or pharmpy SIR etc. But one single NONMEM-run can generate more than one of these and they have a special relation. Estimation runs can be chained and a SIR run can be done after an estimation for example.
The relation between these objects and what was run will reside in another object of another class. It could be as simple as a list of Result objects for each $PROBLEM with a significant order. Also needed is some class were we can read out or manipulate the flow of operations in a model. This might be a third class.
So the classes: Results (each “atomic” result), ResultsStructure (combining all the results of a run) and Operations (manipulating the model).</p>
<p>All the classes mentioned are tool agnostic. We want to support conversion to SO for as many of these as possible, this conversion must be initiated by the ResultsStrcuture object as multiple Results might be combined into one SOBlock. Reading in results to populate the result classes will be tool specific which could be a further subclassing. A tool specific subclassing of ResultsStructure (needs a better name) can read in all results from a specific run. Operations needs to be tools specifically subclassed.</p>
</div>
<div class="section" id="property-operations">
<h3>Property: <cite>operations</cite><a class="headerlink" href="#property-operations" title="Permalink to this headline">¶</a></h3>
<p>A list of ModelOperation objects.
Class hierarcy:</p>
<ul>
<li><p>ModelOperation</p>
<blockquote>
<div><ul>
<li><p>Modelfit</p>
<blockquote>
<div><ul class="simple">
<li><p>SAEM</p></li>
<li><p>FOCE</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Simulation and/or Prediction</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>The number of types of operations (the second level above) should be kept to a minimum.</p>
</div>
<div class="section" id="property-dispatcher">
<h3>Property: <cite>dispatcher</cite><a class="headerlink" href="#property-dispatcher" title="Permalink to this headline">¶</a></h3>
<p>An OperationDispatcher object. This object will be provided by a tool plugin. It shall have a method that take a model as input and tries to carry out the operations of the model. If any operation is not supported it should raise an exception. A model will get a default dispatcher depending on filetype, i.e. a NONMEM model will get the NONMEM plugin dispatcher. It should be possible to replace the dispatcher.</p>
<p>Old notes follow:</p>
<p>Read in one type of output and convert to SO or other standardised output storage.</p>
<p>NONMEM itself can run a small workflow which gives rise to its special output structure.
One level is the PROBLEM, which is represented with $PROBLEM in the model and another level is the SUBPROBLEM,
that is represented by multiple $EST or $SIM in the model. The SO only has one level, the SOBlock, that is mostly
similar to the PROBLEM of the NONMEM output.</p>
</div>
<div class="section" id="api-module-transform">
<h3>API module: <code class="xref py py-mod docutils literal notranslate"><span class="pre">transform</span></code><a class="headerlink" href="#api-module-transform" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Planned but not yet started.</p>
</div>
<p>Transforms models. Should comprise collection of functions that generally take model as input, apply
changes (no copy) and returns it. E.g. adding covariances to expand covariance matrices, changing
distributions (e.g. Box-Cox), etc. Even updating initials is likely to end up here.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No implicit disk writes. Thank you.</p>
</div>
</div>
<div class="section" id="api-module-tool">
<h3>API module: <code class="xref py py-mod docutils literal notranslate"><span class="pre">tool</span></code><a class="headerlink" href="#api-module-tool" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Planned but not yet started.</p>
</div>
<p>A bundle of operations. Organizes a run with standard files generated (like <cite>meta.yaml</cite>?).</p>
</div>
</div>
<div class="section" id="design-ideas">
<h2>Design &amp; Ideas<a class="headerlink" href="#design-ideas" title="Permalink to this headline">¶</a></h2>
<div class="section" id="second-layer-abstraction">
<h3>Second-layer abstraction<a class="headerlink" href="#second-layer-abstraction" title="Permalink to this headline">¶</a></h3>
<p>Shall be generally followed throughout, where a 2nd layer bridges the
non-agnostic implementation details to the agnostic shared functionality (and ultimately, the tools
using the API). Such a 2nd layer shall have these characteristics:</p>
<ol class="arabic simple">
<li><p>Define a generic template with functions swallowing as much as possible, with <code class="docutils literal notranslate"><span class="pre">raise</span>
<span class="pre">NotImplementedError</span></code> where such cannot be done.</p></li>
<li><p>Be inherited by implementations for specificity. Ideally, <code class="docutils literal notranslate"><span class="pre">super()</span></code> shall be used as much as
possible (<em>especially</em> in <code class="docutils literal notranslate"><span class="pre">__init__</span></code>).</p></li>
<li><p>Generic templates hold helper classes that <em>mustn’t</em> be inherited. Unless it’s a good idea
somewhere, but I doubt it (so forget it). These contain data which has been extracted, is
bi-directional and can be applied across model types.</p></li>
</ol>
<p>Example is <code class="xref py py-mod docutils literal notranslate"><span class="pre">parameters</span></code> with the generic API
<code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterModel</span></code>
(<code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterModel</span></code> implements), but also these 2nd
layers:</p>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Covar</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Scalar</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Var</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterList</span></code></p></li>
</ul>
<p>Usage of these shall not require any knowledge of the implementation. It is
return value of e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">inits</span><span class="p">()</span>  <span class="c1"># generates ParameterModel and returns ParameterList</span>
</pre></div>
</div>
</div>
<div class="section" id="no-caching">
<h3>No Caching<a class="headerlink" href="#no-caching" title="Permalink to this headline">¶</a></h3>
<p>Well, not more than <em>necessary</em>. This means that <code class="docutils literal notranslate"><span class="pre">model.parameters</span></code> above, generates the
<code class="docutils literal notranslate"><span class="pre">ParameterModel</span></code> object at request. In <em>THE implementation</em>, this is through requesting data from
<code class="xref py py-class docutils literal notranslate"><span class="pre">ThetaRecord</span></code>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">OmegaRecord</span></code> (which uses 2nd layers in this case). All
this is then bound into a <code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterList</span></code> (which
inherits <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>) and returned.</p>
</div>
<div class="section" id="inherit-base-types">
<h3>Inherit Base Types<a class="headerlink" href="#inherit-base-types" title="Permalink to this headline">¶</a></h3>
<p>If the 2nd layer is e.g. “list-like”, just inherit <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>. It’s Python 3 and it’s all good!</p>
</div>
<div class="section" id="why-multiple-apis">
<h3>Why Multiple APIs?<a class="headerlink" href="#why-multiple-apis" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As more and more properties giving agnostic objects are added the need for this diminishes. The column_list() method for example is not needed as the columns will be taken directly from the agnostic pandas DataFrame object. Perhaps the model should have a property at the top level for the data.</p>
</div>
<p>Why multiple APIs in a hierarchy and not only one directly on the model class? Compare code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">column_list</span><span class="p">()</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this pollutes the poor namespace!</span>
<span class="n">model</span><span class="o">.</span><span class="n">column_list</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<p>Methods are formalised workflows that implement pharmacometric methods. (These were known as tools in PsN). A method has <em>main input</em>, <em>options</em>, <em>global options</em>, an <em>implementation</em> and <em>results</em>. Each method is organized in a submodule. Examples of methods include:</p>
<ol class="arabic simple">
<li><p>Bootstrap
* Main input: a model and the number of samples
* Options: stratification, no replacement etc
* Implementation: The pharmpy implementation
* Results: A standard BootstrapResults object</p></li>
<li><p>FREM</p></li>
</ol>
<p>All methods are agnostic to model formats and tools used for the basic operations.</p>
<p>The <a class="reference internal" href="reference/pharmpy.methods.html#module-pharmpy.methods" title="pharmpy.methods"><code class="xref py py-mod docutils literal notranslate"><span class="pre">methods</span></code></a> is the toplevel subpackage for methods internal to pharmpy. Each method will have a subnamespace below that, for example <code class="xref py py-mod docutils literal notranslate"><span class="pre">FREM</span></code>, <a class="reference internal" href="reference/pharmpy.methods.bootstrap.html#module-pharmpy.methods.bootstrap" title="pharmpy.methods.bootstrap"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bootstrap</span></code></a> etc.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="todo.html" title="previous page">TO-DO</a>
    <a class='right-next' id="next-link" href="changelog.html" title="next page">Changelog</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018-2020; the Pharmpy development team.<br/>
        Last updated on Feb 15, 2021.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>