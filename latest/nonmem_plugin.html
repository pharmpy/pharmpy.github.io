
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using the NONMEM plugin &#8212; Pharmpy 0.22.0 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.f6b7ca918bee2f46fd9abac01cfb07d5.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1e043a052b0af929e4d8.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Pharmpy command line interface" href="cli.html" />
    <link rel="prev" title="Plots in Pharmpy" href="plots.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">


    
    <a class="navbar-brand" href="index.html">
      <p class="title">Pharmpy</p>
    </a>
    

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    
    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="getting_started.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="user_guide.html">
  User guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="reference/modules.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="contribute.html">
  Contribute
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="changelog.html">
  Changelog
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="license.html">
  License
 </a>
</li>

        
      </ul>

      <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user_guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model.html">The Pharmpy model</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html">Datasets in Pharmpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="modeling.html">Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="plots.html">Plots in Pharmpy</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using the NONMEM plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html">The Pharmpy command line interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_r.html">Pharmpy in R</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference/modules.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/nonmem_plugin.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#names-of-parameters-and-random-variables">
   Names of parameters and random variables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-in-a-model">
     Reading in a model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#new-parameters-and-random-variables">
     New parameters and random variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#writing-a-model">
     Writing a model
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>


              
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="using-the-nonmem-plugin">
<h1>Using the NONMEM plugin<a class="headerlink" href="#using-the-nonmem-plugin" title="Permalink to this headline">¶</a></h1>
<p>This page will cover different topics relevant to users who are using Pharmpy for a NONMEM model.</p>
<div class="section" id="names-of-parameters-and-random-variables">
<h2>Names of parameters and random variables<a class="headerlink" href="#names-of-parameters-and-random-variables" title="Permalink to this headline">¶</a></h2>
<p>When Pharmpy parses a model, it recognizes and stores etas, thetas etc. as parameters and random variables. You can
configure which names Pharmpy uses when parsing the model file, i.e. what they are called when you want to access them
using transformation functions etc. You can also configure how etas are written once you have added new etas. The
naming system can be divided into three parts: how the names are parsed from NONMEM code, how new names are added to
the model object, and how new names are written into NONMEM code.</p>
<div class="section" id="reading-in-a-model">
<h3>Reading in a model<a class="headerlink" href="#reading-in-a-model" title="Permalink to this headline">¶</a></h3>
<p>When Pharmpy parses the NONMEM model file, depending on your Pharmpy configuration file (see <a class="reference internal" href="configuration.html#config-page"><span class="std std-ref">Configuration</span></a>)
it will use different names for the internal representation of parameters. The following naming schemes are supported:</p>
<ul class="simple">
<li><p>Standard NONMEM names (‘basic’)</p></li>
<li><p>Comments next to $THETA, $OMEGA, and $SIGMA records (‘comment’)</p></li>
<li><p>Any abbreviated names from $ABBR (‘abbr’)</p></li>
</ul>
<p>You can set which naming schemes you want to use, and prioritize between them. For each parameter and random variable,
Pharmpy will check which names are available and choose the one that is highest in priority. For example, assume you
have the following configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parameter_names</span><span class="o">=</span><span class="n">abbr</span><span class="p">,</span><span class="n">comment</span><span class="p">,</span><span class="n">basic</span>
</pre></div>
</div>
<p>Where names from abbreviated records are prioritized first, comments next, and finally the basic NONMEM names.
Given the following model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$PROBLEM SIMPLE MODEL
$DATA pheno.dta IGNORE=@
$INPUT ID TIME AMT WGT APGR DV
$SUBROUTINE ADVAN1 TRANS2

$ABBR REPLACE THETA(CL)=THETA(1)
$ABBR REPLACE ETA(CL)=ETA(1)

$PK
CL=THETA(CL)*EXP(ETA(CL))
V=THETA(2)*EXP(ETA(2))
S1=V

$ERROR
Y=F+F*EPS(1)

$THETA (0,0.00469307) ; TVCL
$THETA (0,1.00916) ; TVV
$OMEGA 0.0309626  ; IVCL
$OMEGA 0.031128
$SIGMA 0.1
</pre></div>
</div>
<p>For the first theta, <cite>TVCL</cite>, <cite>THETA_CL</cite>, and <cite>THETA(1)</cite> are possible names. Since the setting for abbreviated names is
prioritized the highest, <cite>THETA_CL</cite> will be used. Note that <cite>THETA(CL)</cite> is parsed as <cite>THETA_CL</cite>. For the
second omega record, there is no abbreviated name and no comment, so it will simply be called <cite>OMEGA(2,2)</cite>.</p>
</div>
<div class="section" id="new-parameters-and-random-variables">
<h3>New parameters and random variables<a class="headerlink" href="#new-parameters-and-random-variables" title="Permalink to this headline">¶</a></h3>
<p>When performing different transformations or manipulations of the model, the names of the parameters and random
variables do not have to follow the previously mentioned name schemes. Let’s say we have a model with no etas, and
the model is transformed accordingly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add_iiv</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;CL&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">update_source</span><span class="p">()</span>
</pre></div>
</div>
<p>If you add an eta to the parameter clearance (<cite>CL</cite>), the new eta name will default to <cite>ETA_CL</cite> and the omega name
<cite>IIV_CL</cite>. When performing subsequent transformations, <cite>ETA_CL</cite> and <cite>IIV_CL</cite> are the names you will refer to even if
the NONMEM name for them would be <cite>ETA(1)</cite> and <cite>OMEGA(1,1)</cite> respectively. Now we want to remove that eta:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">remove_iiv</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ETA_CL&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>We still have to refer to the eta as <cite>ETA_CL</cite>, regardless of whether you have called
<a class="reference internal" href="reference/pharmpy.modeling.html#pharmpy.modeling.update_source" title="pharmpy.modeling.update_source"><code class="xref py py-func docutils literal notranslate"><span class="pre">pharmpy.modeling.update_source()</span></code></a> or not. If you update the NONMEM code, <cite>ETA_CL</cite> will be replaced
with <cite>ETA(1)</cite> in the code (this does however not affect the Pharmpy name).</p>
</div>
<div class="section" id="writing-a-model">
<h3>Writing a model<a class="headerlink" href="#writing-a-model" title="Permalink to this headline">¶</a></h3>
<p>When calling <cite>update_source()</cite> or <cite>write_model()</cite>, the NONMEM code will be updated based on your changes. As a default,
all parameters will have NONMEM names in the code and their Pharmpy name (if different from NONMEM name)
as comments. For example, if you’ve added a new parameter <cite>MAT</cite> (in a model with no thetas), the resulting theta
<cite>POP_MAT</cite> will look like this in the NONMEM code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$PK
MAT = THETA(1)
…
$THETA (0,0.1) ; POP_MAT
</pre></div>
</div>
<p>Note that the internal Pharmpy name still is <cite>POP_MAT</cite> despite it being called <cite>THETA(1)</cite> in the code.</p>
<p>The configuration can be set to write eta names as $ABBR records via the setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">write_etas_in_abbr</span><span class="o">=</span><span class="kc">True</span>
</pre></div>
</div>
<p>This setting can be set to <cite>True</cite> or <cite>False</cite> (default). Using the example of adding an eta to clearance (<cite>CL</cite>), the updated
code will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ABBR REPLACE ETA(CL)=ETA(1)
$PK
CL=TVCL*EXP(ETA(CL))
…
$OMEGA 0.09 ; IIV_CL
</pre></div>
</div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="plots.html" title="previous page">Plots in Pharmpy</a>
    <a class='right-next' id="next-link" href="cli.html" title="next page">The Pharmpy command line interface</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.1e043a052b0af929e4d8.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018-2021; the Pharmpy development team.<br/>
        Last updated on Mar 29, 2021.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>